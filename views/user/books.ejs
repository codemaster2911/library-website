<!DOCTYPE html>
<html lang="zxx">


<head>

    <!-- Meta -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1">

    <!-- Title -->

    <title>Books</title>


    <!-- Favicon -->
    <link href="../images/favicon.ico" rel="icon" type="image/x-icon" />

    <!-- Fonts -->
    <link
        href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i,800,800i%7CLato:100,100i,300,300i,400,400i,700,700i,900,900i"
        rel="stylesheet" />
    <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/fontawesome.min.css"
        integrity="sha384-wESLQ85D6gbsF459vf1CiZ2+rr+CsxRY0RpiF1tLlQpDnAgg6rwdsUF1+Ics2bni" crossorigin="anonymous">
    <link href="../css/font-awesome.min.css" rel="stylesheet" type="text/css" />

    <!-- Mobile Menu -->
    <link href="../css/mmenu.css" rel="stylesheet" type="text/css" />
    <link href="../css/mmenu.positioning.css" rel="stylesheet" type="text/css" />

    <!-- Responsive Table -->
    <link rel="stylesheet" type="text/css" href="../css/responsivetable.css" />

    <!-- Stylesheet -->

    <link href="../style.css" rel="stylesheet" type="text/css" />
    <script src="https://kit.fontawesome.com/ad214375d6.js" crossorigin="anonymous"></script>
</head>

<body>

    <!-- Start: Header Section -->
    <header id="header-v1" class="navbar-wrapper inner-navbar-wrapper">
        <div class="container">
            <div class="row">
                <nav class="navbar navbar-default">
                    <div class="row">
                        <div class="col-md-3">
                            <div class="navbar-header">
                                <div class="navbar-brand">
                                    <h1>
                                        <a href="iiti.ac.in">
                                            <img style="width: 70%; height: 70%;"
                                                src="https://lh3.googleusercontent.com/proxy/NJ-cRlY4_-WuFEev_QEwptd3pgLXKn8kdHk5BzpVOI4dClZqW-CQWAjxmfuFa0z1Jt-ZCJC5aUfpfCIcfikYp323OdR6IjT5oEQ"
                                                alt="LIBRARY" />
                                        </a>
                                    </h1>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-9">
                            <!-- Header Topbar -->
                            <div class="header-topbar hidden-sm hidden-xs">
                                <div class="row">
                                    <div class="col-sm-6">
                                        <div class="topbar-info">
                                            <a href="tel:0731-6603424"><i class="fa fa-phone"></i>0731-6603424</a>
                                            <span>/</span>
                                            <a href="mailto:library@iiti.ac.in"><i
                                                    class="fa fa-envelope"></i>library@iiti.ac.in</a>
                                        </div>
                                    </div>
                                    <div class="col-sm-6">
                                        <div class="topbar-links">
                                            <a href="<%=path%>auth/logout"><i class="fa fa-lock"></i>Log Out</a>
                                            <!-- <span>|</span>
                                            <div class="header-cart dropdown">
                                                <a data-toggle="dropdown" class="dropdown-toggle" href="#">
                                                    <i class="fa fa-shopping-cart"></i>
                                                    <i class="fa fa-heart"></i>
                                                </a>

                                                <div class="dropdown-menu cart-dropdown">
                                                    <ul>
                                                        <li class="clearfix">
                                                            <img src="../images/header-cart-image-01.jpg"
                                                                alt="cart item" />
                                                            <div class="item-info">
                                                                <div class="name">
                                                                    <a href="#"> Book's title </a>
                                                                </div>
                                                                <div class="author"><strong>Author : </strong> Author's
                                                                    name </div>
                                                            </div>
                                                            <a class="remove" title="Remove from favorite" href="#"><i
                                                                    class="fa fa-heart"></i></a>
                                                        </li>
                                                        <li class="clearfix">
                                                            <img src="../images/header-cart-image-02.jpg"
                                                                alt="cart item" />
                                                            <div class="item-info">
                                                                <div class="name">
                                                                    <a href="#"> Book's title </a>
                                                                </div>
                                                                <div class="author"><strong>Author : </strong> Author's
                                                                    name </div>
                                                            </div>
                                                            <a class="remove" title="Remove from favorite" href="#"><i
                                                                    class="fa fa-heart"></i></a>
                                                        </li>
                                                        <li class="clearfix">
                                                            <img src="../images/header-cart-image-03.jpg"
                                                                alt="cart item" />
                                                            <div class="item-info">
                                                                <div class="name">
                                                                    <a href="#"> Book's title </a>
                                                                </div>
                                                                <div class="author"><strong>Author : </strong> Author's
                                                                    name </div>
                                                            </div>
                                                            <a class="remove" href="#"><i class="fa fa-heart"></i></a>
                                                        </li>
                                                    </ul>
                                                    <div class="cart-buttons">
                                                        <a href="#" class="btn btn-dark-gray">Reading list</a>
                                                    </div>
                                                </div>
                                            </div> -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="navbar-collapse hidden-sm hidden-xs">
                                <ul class="nav navbar-nav">
                                    <li class="dropdown">

                                        <a data-toggle="dropdown" class="dropdown-toggle disabled"
                                            href="<%=path%>user/home">Home</a>

                                    </li>
                                    <li class="dropdown active">
                                        <a data-toggle="dropdown" class="dropdown-toggle disabled" href="<%=path%>user/books">Books</a>
                                    </li>
                                    <li class="dropdown ">
                                        <a data-toggle="dropdown" class="dropdown-toggle disabled"
                                            href="<%=path%>user/friends">Find Friends</a>
                                    </li>
                                    <li><a href="<%=path%>aboutus">About Us</a></li>
                                    <li><a href="<%=path%>contactus">Contact Us</a></li>

                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="mobile-menu hidden-lg hidden-md">
                        <a href="#mobile-menu"><i class="fa fa-navicon"></i></a>
                        <div id="mobile-menu">
                            <ul>
                                <li class="mobile-title">
                                    <h4>Navigation</h4>
                                    <a href="#" class="close"></a>
                                </li>

                                <li>
                                    <a href="<%=path%>user/home">Home</a>
                                </li>
                                <li>
                                    <a href="<%=path%>user/books">Books</a>
                                </li>
                                <li>
                                    <a href="<%=path%>user/friends">Find Friends</a>
                                </li>
                                <li><a href="<%=path%>aboutus">About Us</a></li>
                                <li><a href="<%=path%>contactus">Contact Us</a></li>

                            </ul>
                        </div>
                    </div>
                </nav>
            </div>
        </div>
    </header>
    <!-- End: Header Section -->
    <!-- Button trigger modal -->
    <!-- Start: Page Banner -->
    <section class="page-banner services-banner">
        <div class="container">
            <div class="banner-header">
                <h2> Books </h2>
                <span class="underline center"></span>
                <p class="lead">A room without books is like a body without soul.</p>
            </div>
            <div class="breadcrumb">
                <ul>
                    <li><a href="<%=path%>user/home">Home</a></li>
                    <li>Books</li>
                </ul>
            </div>
        </div>
    </section>
    <!-- End: Page Banner -->

    <!-- Start: Products Section -->
    <div id="content" class="site-content">
        <div id="primary" class="content-area">
            <main id="main" class="site-main">
                <div class="booksmedia-detail-main">
                    <div class="container">
                        <div class="row">
                            <!-- Start: Search Section -->
                            <section class="search-filters">
                                <div class="container">
                                    <div class="filter-box">
                                        <h3>What are you looking for at the library?</h3>
                                        <form class="searchform">
                                            <div class="col-md-4 col-sm-6">
                                                <div class="form-group">
                                                    <label class="sr-only" for="keywords"> Search</label>
                                                    <input value="<%=search%>" class="form-control" placeholder="Search by Title"
                                                        id="keywords" name="keywords" type="text">
                                                </div>
                                            </div>
                                            <div class="col-md-3 col-sm-6">
                                                <div class="form-group">
                                                    <select name="category" id="searchcriteria" class="form-control">
                                                        <option>Search by Name</option>
                                                        <option> Search by Author </option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-2 col-sm-6">
                                                <div class="form-group">
                                                    <input class="form-control searchbutton" type="submit"
                                                        value="Search">
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </section>
                            <!-- End: Search Section -->
                        </div>
                        <table class="searchbooks">

                        </table>
                    </div>



                </div>
        </div>
        </main>
    </div>
    </div>
    <!-- End: Products Section -->

    <!-- Start: Social Network -->
    <section class="social-network section-padding">
        <div class="container" style="margin: auto; ">
            <div class="center-content">
                <h2 class="section-title">Follow Us</h2>
                <span class="underline center"></span><br><br>
            </div>
            <ul style="margin: auto; padding-left: 250px;">
                <li style="width: 100px; margin: 10px 10px;">
                    <a class="facebook" href="#" target="_blank" style=" height: 100px;">
                        <span>
                            <i class="fa fa-facebook-f" style="font-size: 50px;"></i>
                        </span>
                    </a>
                </li>
                <li style="width: 100px; margin: 10px 10px;">
                    <a class="twitter" href="#" target="_blank" style=" height: 100px;">
                        <span>
                            <i class="fa fa-twitter" style="font-size: 50px;"></i>
                        </span>
                    </a>
                </li>
                <li style="width: 100px; margin: 10px 10px;">
                    <a class="google" href="#" target="_blank"style=" height: 100px;">
                        <span>
                            <i class="fa fa-google-plus" style="font-size: 50px;"></i>
                        </span>
                    </a>
                </li>
                <li style="width: 100px; margin: 10px 10px;">
                    <a class="linkedin" href="#" target="_blank" style=" height: 100px;">
                        <span>
                            <i class="fa fa-linkedin" style="font-size: 50px;"></i>
                        </span>
                    </a>
                </li>
                <li style="width: 100px; margin: 10px 10px;">
                    <a class="youtube" href="#" target="_blank" style=" height: 100px;">
                        <span>
                            <i class="fa fa-youtube" style="font-size: 50px;"></i>
                        </span>
                    </a>
                </li>
            </ul>
        </div>
    </section>
    <!-- End: Social Network -->

    <!-- Start: Footer -->
    <footer class="site-footer">
        <div class="container">
            <div id="footer-widgets">
                <div class="row">
                    <div class="col-md-4 col-sm-6 widget-container">
                        <div id="text-2" class="widget widget_text">
                            <h3 class="footer-widget-title">About Library</h3>
                            <span class="underline left"></span>
                            <div class="textwidget">
                                “Sometimes, you read a book and it fills you with this weird evangelical zeal, and you
                                become convinced that the shattered world will never be put back together unless and
                                until all living humans read the book.”
                            </div>
                            <address>
                                <div class="info">
                                    <i class="fa fa-location-arrow"></i>
                                    <span> IIT Indore, Khandwa Road, SIMROL, <br> District : Indore – 453552, Madhya
                                        Pradesh, India</span>
                                </div>
                                <div class="info">
                                    <i class="fa fa-envelope"></i>
                                    <span><a href="mailto:library@iiti.ac.in">library@iiti.ac.in</a></span>
                                </div>
                                <div class="info">
                                    <i class="fa fa-phone"></i>
                                    <span><a href="tel:0731-6603424">0731-6603424</a></span>
                                </div>
                            </address>
                        </div>
                    </div>

                    <div class="col-md-2 col-sm-6 widget-container">
                        <div id="nav_menu-2" class="widget widget_nav_menu">
                            <h3 class="footer-widget-title">Quick Links</h3>
                            <span class="underline left"></span>
                            <div class="menu-quick-links-container">
                                <ul id="menu-quick-links" class="menu">

                                    <li><a href="<%=path%>user/home">Home</a></li>
                                    <li><a href="<%=path%>user/books">Books</a></li>
                                    <li><a href="<%=path%>user/friends">Find Friends</a></li>
                                    <li><a href="<%=path%>aboutus">About Us</a></li>
                                    <li><a href="<%=path%>contactus">Contact Us</a></li>

                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="clearfix hidden-lg hidden-md hidden-xs tablet-margin-bottom"></div>

                </div>
            </div>
        </div>

    </footer>
    <!-- End: Footer -->



    <div class="modaltop modal fade" id="exampleModalLong" tabindex="-1" role="dialog"
        aria-labelledby="exampleModalLongTitle" aria-hidden="true">

    </div>




    <!-- jQuery Latest Version 1.x -->
    <script type="text/javascript" src="../js/jquery-1.12.4.min.js"></script>

    <!-- jQuery UI -->
    <script type="text/javascript" src="../js/jquery-ui.min.js"></script>

    <!-- jQuery Easing -->
    <script type="text/javascript" src="../js/jquery.easing.1.3.js"></script>

    <!-- Bootstrap -->
    <script type="text/javascript" src="../js/bootstrap.min.js"></script>

    <!-- Mobile Menu -->
    <script type="text/javascript" src="../js/mmenu.min.js"></script>

    <!-- Harvey - State manager for media queries -->
    <script type="text/javascript" src="../js/harvey.min.js"></script>

    <!-- Waypoints - Load Elements on View -->
    <script type="text/javascript" src="../js/waypoints.min.js"></script>

    <!-- Facts Counter -->
    <script type="text/javascript" src="../js/facts.counter.min.js"></script>

    <!-- MixItUp - Category Filter -->
    <script type="text/javascript" src="../js/mixitup.min.js"></script>

    <!-- Owl Carousel -->
    <script type="text/javascript" src="../js/owl.carousel.min.js"></script>

    <!-- Accordion -->
    <script type="text/javascript" src="../js/accordion.min.js"></script>

    <!-- Responsive Tabs -->
    <script type="text/javascript" src="../js/responsive.tabs.min.js"></script>

    <!-- Responsive Table -->
    <script type="text/javascript" src="../js/responsive.table.min.js"></script>

    <!-- Masonry -->
    <script type="text/javascript" src="../js/masonry.min.js"></script>

    <!-- Carousel Swipe -->
    <script type="text/javascript" src="../js/carousel.swipe.min.js"></script>

    <!-- bxSlider -->
    <script type="text/javascript" src="../js/bxslider.min.js"></script>

    <!-- Custom Scripts -->
    <script type="text/javascript" src="../js/main.js"></script>





    <script>
        let path = window.location.origin;
        $(document).ready(function () {
            $(".searchform").submit(function (e) {
                e.preventDefault();
            })
            const getdata = () => {
                $.ajax({
                    type: "POST",
                    url: path + "/user/getbooksdata", data: { sub: $("#keywords").val(), criteria: $("#searchcriteria").val() }, success: function (result) {
                        console.log(result);
                        $(".searcbooks").find("tr").remove();
                        let s = "";
                        for (let i = 0; i < result.length; i++) {
                            let rating = "<p><strong>Avg. Rating: </strong>";
                            let favbut = "", p = 1, avg, fav, hold, favclas;
                            if (result[i].fav == 1) {
                                fav = 1;
                                favbut = "Favourite <i class='fas fa-heart' style='color: red;'></i>";
                                favclas = "fav"
                            } else {
                                fav = 0;
                                favbut = "Mark as favourite: <i class='far fa-heart'></i>";
                                favclas = "notfav";
                            }
                            avg = result[i].avgRating;
                            console.log(avg);
                            if (result[i].avgRat == null) {
                                avgRat = 0;
                            }
                            while (p <= avg) {
                                rating += "<span><i class='fas fa-star'></i></span>";
                                p++;
                            }
                            while (p <= 5) {
                                rating += "<span><i class='far fa-star'></i></span>";
                                p++;
                            }
                            let userrating = result[i].rating;
                            if (userrating == null) {
                                userrating = 1;
                            }
                            console.log(result[i].ISBN, userrating);
                            p = 1;
                            let opt = "";
                            while (p <= 5) {
                                if (p == userrating) {
                                    opt += `<option selected value='${p}'>${p}</option>`;
                                } else {
                                    opt += `<option value='${p}'>${p}</option>`;
                                }
                                p++;
                            }
                            let holdbut = "";
                            if (result[i].holdStatus == 0) {
                                holdbut = "disabled";
                            }
                            s += (`<tr><th><div class="booksmedia-detail-box">
                                    <div class="detailed-box">
                                        <div class="col-xs-12 col-sm-5 col-md-3">
                                            <div class="post-thumbnail">
                                                
                                                <img src="${result[i].image}"
                                                    alt="Book Image">
                                            </div>
                                        </div>
                                        <div  class="col-xs-12 col-sm-7 col-md-6">
                                            <div style="width : 100%;" class="post-center-content">
                                                <h2> ${result[i].title} </h2>
                                                <p><strong>Author : </strong> ${result[i].authors} </p>
                                                <p><strong>ISBN : </strong> ${result[i].ISBN} </p>
                                                ${rating}
                                                <p><strong>Year of Publication :</strong> ${result[i].yearOfPublication} </p>
                                                <p><strong>Category : </strong>${result[i].category} </p>
                                                <div class="form-group">
                                                    <p><strong>Your rating: <select style="width: 50px; display: inline; height: 50px;" value=${result[i].rating}' name="userrating" class="${result[i].ISBN} userrating form-control">
                                                            ${opt}
                                                        </select>
                                                </div>
                                                <div class="actions">
                                                    <ul>
                                                        
                                                        <li>
                                                            <p data-toggle="blog-tags"
                                                                data-placement="top" title=""
                                                                data-original-title="Add to favorite">
                                                                    <div style="cursor:pointer;" class='${result[i].ISBN} ${favclas}'>
                                                                        ${favbut}
                                                                        </div>
                                                            </p>
                                                        </li>
                                                        
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-xs-12 col-sm-12 col-md-3 ">
                                            <div class="post-right-content">
                                                <p><strong>Total Copies :</strong> ${result[i].totalCopies} </p>
                                                <p><strong>Holds :</strong> ${result[i].numholds} </p>
                                                <p><strong>No. of copies in shelf :</strong> ${result[i].noOfCopiesOnShelf} </p>
                                                <button class="${result[i].ISBN} placehold btn btn-dark-gray" ${holdbut}>Place a Hold</button>
                                                <button type="button" class="${result[i].ISBN} reviews btn btn-dark-gray" data-toggle="modal" data-target="#exampleModalLong">
                                                    Ratings and Reviews
                                                </button>
                                            </div>
                                        </div>
                                        <div class="clearfix"></div>
                                    </div>
                                    <div class="clearfix"></div>
                                </div></th></tr>`)
                        }
                        $(".searchbooks").html(s);
                    }
                });
            }
            $(".searchbutton").click(function () {
                getdata();
            });
            $(document).ready(() => {
                getdata();
            })
            $(document).on('click', '.notfav', function (e) {
                console.log('clicked');
                let read = "null";
                while (read != "yes" && read != "no") {
                    read = window.prompt('Have you read the book? (yes/no) (case-sensitive)');
                }
                console.log(read);
                let isbn = $(this).attr('class').split(' ')[0];
                $.ajax({
                    type: 'POST', url: path + '/user/markfav', data: { isbn, read }, success: (result) => {
                        $(this).removeClass('notfav');
                        $(this).addClass('fav');
                        $(this).html("Favourite <i class='fas fa-heart' style='color: red;'></i>");
                    }
                })
            })

            $(document).on('click', '.fav', function (e) {
                let isbn = $(this).attr('class').split(' ')[0];
                $.ajax({
                    method: 'POST',
                    url: path + "/user/unmarkfav",
                    data: { isbn },
                    success: (result) => {
                        $(this).removeClass('fav');
                        $(this).addClass('notfav');
                        $(this).html("Mark as favourite: <i class='far fa-heart'></i>");
                    }
                })
            })
            $(document).on('click', '.placehold', (e) => {
                let isbn = $(e.target).attr('class').split(' ')[0];
                if (confirm('Are you sure you want to place hold on this book?')) {
                    $.ajax({
                        type: 'post',
                        url: path + "/user/requesthold",
                        data: {
                            isbn
                        },
                        success: (result) => {
                            console.log(result);
                            let status = result['@status'];
                            let message = "";
                            if (status == 1) {
                                message += 'Your hold request was placed.';
                                $(e.target).attr('disabled', 'true');
                            } else if (status == 2) {
                                message += 'Hold Request is already placed by someone else.';
                            } else if (status == 3) {
                                message += 'You have reached your hold limit.';
                            } else {
                                message += 'Please pay your unpaid fines before placing hold.'
                            }
                            alert(message);
                        }
                    })
                }
            })
            $(document).on('change', '.userrating', (e) => {
                let isbn = e.target.attributes['3'].nodeValue.split(' ')[0];
                let userrate = e.target.value;
                console.log(isbn, userrate);
                $.ajax({
                    type: 'POST',
                    url: path + "/user/rate",
                    data: {
                        isbn,
                        rating: userrate
                    },
                    success: (result) => {

                    }
                })
            })

            $(document).on('click', '.reviews', (e) => {
                let isbn = $(e.target).attr('class').split(' ')[0];
                console.log(isbn);
                $.ajax({
                    type: 'POST',
                    url: path + '/user/getreviews',
                    data: {
                        isbn
                    }, success: (reviews) => {
                        let len = reviews.length;
                        let prev = "";
                        let userrev = "";
                        for (let i = 0; i < len; i++) {
                            prev += `<tr>
                                        <td> ${i + 1}. </td>
                                        <td> ${reviews[i].reviewText} - ${reviews[i].name} </td>
                                    </tr>`;
                        }
                        let p = `<div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLongTitle"> Rating and Reviews </h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
        
        
        
                            <div class="contact-us">
                                <div class="row">
                                    <div class="contact-area" style="padding-top: 0px;">
                                        <div class="container">
        
                                            <div class="contact-form bg-light margin-right"
                                                style="width: 50%; margin-top: 0px;">
                                                <span style="font-size: large; font-weight: bolder;">Please Enter a review for the book:</span>
                                                <div class="contact-fields">
                                                    <form class="reviewsub">
                                                        <div class="row">
                                                            <div class="col-sm-12">
                                                                <div class="form-group">
                                                                    <textarea class="reviewtext form-control"
                                                                        placeholder="Give Review"
                                                                        
                                                                        aria-required=""></textarea>
                                                                    <div class="clearfix"></div>
                                                                </div>
                                                            </div>
        
                                                            <div class="col-sm-12">
                                                                
                                                            </div>
        
                                                        </div>
                                                    </form>
                                                </div>
                                            </div>
        
                                        </div>
                                    </div>
                                </div>
                            </div>
        
        
                            <table class="table table-bordered">
        
                                <thead style="background-color: black; color: white;">
                                    <tr>
                                        <th> &nbsp; </th>
                                        <th> Reviews </th>
                                        <!-- <th> Name </th>
                                        <th> UserID </th> -->
                                    </tr>
                                </thead>
        
                                <tbody>
                                    ${prev}
                                </tbody>
        
                            </table>
        
        
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="${isbn} reviewbtn btn btn-secondary" data-dismiss="modal">  Save changes  </button>
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">  Close  </button>
                        </div>
                    </div>
                </div>`;
                        $('.modaltop').html(p);
                        $(document).on('click', '.reviewbtn', () => {
                            let review = $('.reviewtext').val();
                            if (review.length) {

                                $.ajax({
                                    type: 'POST',
                                    url: path + '/user/addreview',
                                    data: {
                                        isbn,
                                        review
                                    }, success: (result) => {
                                        console.log(result.message);
                                    }
                                })
                            }
                        })
                    }
                })
            })
            $(document).on('submit', '.reviewsub', e => {
                e.preventDefault();
            })

        });
    </script>
</body>

</html>